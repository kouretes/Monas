message ( STATUS "" )
message ( STATUS " _..::: Configuring Providers :::.._ " )
message ( STATUS "" )

#______________________________________________________________________
# Select build type for user Activities. User Activities can be build as an
# archive static library ( STATIC option ), as a dynamically loaded
# library ( SHARED option ) or as a run-time dynamically loaded library
# ( MODULE option ).

set ( ProviderBuildType SHARED CACHE STRING
        "Choose build type for user Providers. Available options are STATIC, SHARED and MODULE" )

if ( "x${ProviderBuildType}x" STREQUAL "xx" )
  message ( FATAL_ERROR "ActivityBuildType is not set!" )
elseif ( (NOT "${ProviderBuildType}" STREQUAL "STATIC") AND
         (NOT "${ProviderBuildType}" STREQUAL "SHARED") AND
         (NOT "${ProviderBuildType}" STREQUAL "MODULE") )
  message ( FATAL_ERROR "ActivityBuildType should be one of the following: STATIC, SHARED or MODULE" )
endif ( "x${ProviderBuildType}x" STREQUAL "xx" )



#________________________________________________________________
# Write activity registry file in case of static module building,
# else create an empty file because the file is always included
# by the architecture

if ( "${ProviderBuildType}" STREQUAL "STATIC" )
    file ( WRITE  providerRegistry.h   "/*************************************************************  \n" )
    file ( APPEND providerRegistry.h   "****** WARNING AUTOGENERATED FILE - DO NOT EDIT MANUALLY *****  \n" )
    file ( APPEND providerRegistry.h   "*************************************************************/  \n" )
else( "${ProviderBuildType}" STREQUAL "STATIC" )
    file ( WRITE  providerRegistry.h   "/*************************************************************  \n" )
    file ( APPEND providerRegistry.h   "********* WARNING AUTOGENERATED FILE - DO NOT DELETE *********  \n" )
    file ( APPEND providerRegistry.h   "*************************************************************/  \n" )
endif ( "${ProviderBuildType}" STREQUAL "STATIC" )



#___________________________________________________________
# Autodetect user Providers and add them to the building tree.

file ( GLOB FilesInDir . * )

foreach ( afile ${FilesInDir} )
    if ( IS_DIRECTORY ${afile} )
        set ( theSubDirs ${theSubDirs}  ${afile}  )
        message ( STATUS "Provider ${afile} detected and added to the building tree" )
    endif ( IS_DIRECTORY ${afile} )
endforeach ( afile )


foreach ( subdir ${theSubDirs} )
    add_subdirectory( ${subdir} )
endforeach ( subdir ${theSubDirs} )


#________________________________________________________
# Back propagate TargetLinkLibraries variable in order to
# make available the library names to the linker. This is
# needed in both STATIC and SHARED built Activities but not
# for "MODULE" Activities.

if ( ("${ProviderBuildType}" STREQUAL "STATIC") OR
        ("${ProviderBuildType}" STREQUAL "SHARED") )

    set ( ProviderLibraries ${ProviderLibraries} PARENT_SCOPE)

endif ( ("${ProviderBuildType}" STREQUAL "STATIC") OR
        ("${ProviderBuildType}" STREQUAL "SHARED") )

