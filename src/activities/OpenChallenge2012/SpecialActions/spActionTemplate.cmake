message ( STATUS "" )
message ( STATUS " _..::: Configuring ${SpecialActionName} :::.._ " )
message ( STATUS "" )


#___________________________________________________________________
# If the user modules are build statically linked autogenerated code
# will register them into the activitys factory. This solve the 
# issue in which the linker will not copy any not used symbol
# into the executable and thus not the global variable that 
# registers normally the activity.


if ( "${ActivityBuildType}" STREQUAL "STATIC" )


# Check that the name of the Activity is the same with the header file 

file ( READ ${SpecialActionName}.h FileData )

if ( NOT FileData )
   message ( "Warning: ${CMAKE_CURRENT_SOURCE_DIR}/${SpecialActionName}.h does not exist!" )
   message ( "Warning: The ActivityName, the directory, the filename of the header file and the class name" )
   message ( "         must have the same name. The name IS case sensitive! " )
endif ( NOT FileData )


# The read file has to declare a class with the same name as the Activity's Name 

string ( REGEX MATCH "class ${SpecialActionName} " ClassFound ${FileData} )

if ( "A${ClassFound}A" STREQUAL "AA" )
    message ( "Warning: Cound not find class ${SpecialActionName} in ${SpecialActionName}.h ")
endif ( "A${ClassFound}A" STREQUAL "AA" )


# Autogenerate the cpp code that needed to register the new activity into the factory

file ( APPEND ../spRegistry.h "\n" )
file ( APPEND ../spRegistry.h "#include \"${SpecialActionName}/${SpecialActionName}.h\" \n" )
file ( APPEND ../spRegistry.h "namespace { \n" )
file ( APPEND ../spRegistry.h "   SpecialActionRegistrar<${SpecialActionName}>::Type temp_${SpecialActionName}\(\"${SpecialActionName}\"\); \n")
file ( APPEND ../spRegistry.h "}\n" )
file ( APPEND ../spRegistry.h "\n" )


endif ( "${ActivityBuildType}" STREQUAL "STATIC" )



#___________________________________________________________________
# If the user module is not built as "MODULE" ( run-time dynamically 
# linked library ), the library has to be linked with the executable.
# Thus the library name is appended to the appropriate variable.

if ( NOT "${ActivityBuildType}" STREQUAL "MODULE" )
set ( SpecialActionLibraries ${SpecialActionLibraries} ${SpecialActionName} PARENT_SCOPE )
endif ( NOT "${ActivityBuildType}" STREQUAL "MODULE" )



add_library ( ${SpecialActionName} ${ActivityBuildType} ${SpecialActionSrcs} )
    
install ( TARGETS ${SpecialActionName} 
            RUNTIME DESTINATION   bin
            LIBRARY DESTINATION   lib
            ARCHIVE DESTINATION   lib/static )

